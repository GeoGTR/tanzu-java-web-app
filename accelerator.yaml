accelerator:
  displayName: Tanzu Java Web App
  description: A sample Spring Boot web application built with Tanzu supply-chain
  iconUrl: https://github.com/sample-accelerators/icons/raw/master/icon-boot.png
  tags:
  - java
  - spring
  - web
  - tanzu

  options:
  # - name: repositoryPrefix
  #   inputType: text
  #   label: Prefix for the container image repository
  #   defaultValue: dev.local
  #   required: true
  - name: instances
    label: Minimum number of instances to start
    inputType: select
    display: true
    defaultValue: "1"
    choices:
      - text: "no instaces"
        value: "0"
      - text: "1 instance"
        value: "1"
      - text: "2 instances"
        value: "2"

  imports:
  - name: java-version

engine:
  chain:
  - merge:
    - include: [ "**/*" ]
      exclude: [ "config/*.yaml", "Tiltfile", "README.md", "grype.yaml", "catalog/*.yaml", ".github/workflows/**", "pom.xml" ]
    - include: [ "config/*.yaml", "Tiltfile" ]
      let:
      - name: repositoryPrefix
        expression: "'dev.local'"
      chain:
      - type: ReplaceText
        substitutions:
        - text: tanzu-java-web-app
          with: "#artifactId"
      - type: ReplaceText
        substitutions:
        - text: your-registry.io/project
          with: "#repositoryPrefix"
    - include: [ "README.md" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: tanzu-java-web-app
          with: "#artifactId"
    - include: [ "config/workload.yaml" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: "<INSTANCES>"
          with: "#instances"
    - include: [ "catalog/*.yaml" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: tanzu-java-web-app
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "#filename"
  - merge:
    - include: [ "**" ]
    - type: InvokeFragment
      reference: java-version
